<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Form</title>

    <!-- Add Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/assets/skmei_watch/images/favicon.ico">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="./index.css">
</head>

<body>
    <div id="loading-overlay">
        <div class="spinner"></div>
    </div>
      
    <!-- Navbar -->
    <nav class="navbar navbar-light bg-white text-center py-3">
        <div class="container">
            <a href="https://skmei.in" target="_blank" rel="noopener noreferrer">
                <img src="/assets/skmei_watch/images/skmei_logo-header-min (1).png" alt="Company Logo"
                    style="height: 40px;">
            </a>
        </div>
        
    </nav>

    <!-- Support Banner -->
    <div class="support-banner"></div>

    <!-- Support Form Container -->
    <div class="support-container container mt-5">
        <h3>We're Here to Help</h3>
        <p>Fill out the form below and our support team will get back to you shortly.</p>
        <form id="support-form" action="/api/method/skmei_watch.api.utils.create_support_issue" method="POST">
            <!-- Row 1 -->
            <div class="row">
                <div class="col-md-6 my-1">
                    <label for="customer_name" class="form-label required">Name</label>
                    <input type="text" name="customer_name" class="form-control" required>
                </div>
                <div class="col-md-6 my-1">
                    <label for="mobile_number" class="form-label required">Mobile Number</label>
                    <input type="text" name="mobile_number" id="mobile_number" class="form-control"
                        placeholder="Enter your mobile number" required pattern="^[6-9]\d{9}$"
                        title="Please enter a valid 10-digit mobile number starting with 6, 7, 8, or 9">
                </div>
                <div class="col-md-6 my-1">
                    <label for="email" class="form-label required">Email ID</label>
                    <input type="email" name="email" id="email" class="form-control" placeholder="Enter your email"
                        required pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
                        title="Please enter a valid email address">
                    <div class="invalid-feedback">
                        Please enter a valid email address.
                    </div>
                </div>
                <div class="col-md-6 my-1">
                    <label for="custom_order_number" class="form-label required">Order Id</label>
                    <input type="text" name="custom_order_number" class="form-control" required>
                </div>
                <div class="col-md-6 my-1">
                    <label for="issue_type" class="form-label required">Ticket Type</label>
                    <select name="issue_type" class="form-select" id ="issue_type" required>
                        <option value="" disabled selected>Select an Option</option>
                    </select>
                </div>
                <div class="col-md-6 my-1" >
                    <label for="custom_what_went_wrong" class="form-label required">What went wrong</label>
                    <input type="text" name="custom_what_went_wrong" class="form-control" required>
                </div>

                

                <div class="col-md-12 my-1" >
                    <label for="description" class="form-label required">Specific reason for cancellation?</label>
                    <textarea name="description" class="form-control" rows="4" required></textarea>
                </div>
                <div class="col-md-6 my-1">
                    <label for="custom_retention_feedback" class="form-label required">We Want You To Keep Our Product,
                        How Can We Make It Right For You?</label>
                    <input type="text" name="custom_retention_feedback" class="form-control" required>
                </div>
                <div class="col-md-12 my-1">
                    <label for="description" class="form-label required">Reason For Returning The Product?</label>
                    <textarea name="description" class="form-control" rows="4" required></textarea>
                </div>
                <div class="col-md-12 my-1" >
                    <label for="description" class="form-label required">Issue Detail</label>
                    <textarea name="description" class="form-control" rows="4" required></textarea>
                </div>
                <div class="col-md-6 my-1" >
                    <label for="custom_watch_back_side_" class="form-label required" >Watch Back Side </label>
                    <input type="file" name="custom_watch_back_side_" class="form-control" id="watch-backside-attachment" rows="4" required></input>
                    <div id="watch-backside-preview" style="margin-top: 10px;"></div>
                </div>
                <div class="col-md-6 my-1" >
                    <label for="custom_watch_front_dial_" class="form-label required">Watch Front Dial</label>
                    <input type="file"  name="custom_watch_front_dial_" class="form-control" id="watch-front-dial-attachment" required></input>
                    <div id="watch-frontdial-preview" style ="margin-top: 10px;"></div>
                </div>
                
                <div class="col-md-6 my-1" >
                    <label for="custom_invoice" class="form-label required">Invoice</label>
                    <input type="file"  name="custom_invoice" class="form-control" id="invoice-attachment" required></input>
                    <div id="invoice-preview" style ="margin-top: 10px;"></div>
                </div>

                <div class="col-md-6 my-1" >
                    <label for="custom_attach_photos_jpg_or_png"  class="form-label required">Attach photos: (jpg or png)</label>
                    <input 
                    type="file" 
                    id="attachments" 
                    name="custom_attach_photos_jpg_or_png" 
                    class="form-control" 
                    accept="image/png, image/jpeg" 
                    required>
                  </input>                  
                    <div id="file-error" style="color: red; margin-top: 5px;"></div>
                    <div id="attachments-preview" style="margin-top: 10px;"></div>
                </div>
                <div class="col-md-6 my-1" >
                    <label for="custom_attach_video_with_issue_1_minute" class="form-label required">Attach Video With Issue( 1 minute) </label>
                    <input 
                    type="file"
                    id="fileUp" 
                    name="custom_attach_video_with_issue_1_minute" 
                    class="form-control" 
                    accept="video/*" 
                    required>
                  </input>
                    <pre id="infos"></pre>
                    <div id="video-preview" style="margin-top: 10px;"></div>
                </div>
                
                <div class="col-md-6 my-1" >
                    <label for="custom_warranty_card_" class="form-label required">Warranty Card </label>
                    <input type="file"  name="custom_warranty_card_" class="form-control" id="warranty-card-attachment"required></input>
                    <div id="warranty-card-preview" style="margin-top: 10px;"></div>
                </div>
            
                <div class="col-md-6 my-1">
                    <label for="custom_tracking_id" class="form-label required">Tracking number</label>
                    <input type="text" name="custom_tracking_id" class="form-control" required>
                </div>

                <div class="col-md-12 my-1" >
                    <label for="description" class="form-label required">Issue detail</label>
                    <input type="text" name="description" class="form-control" required>
                </div>
                
            </div>

            <!-- Submit Button -->
            <div class="row">
                <div class="col-12 text-left my-3">
                    <button type="submit" class="btn btn-danger">Submit</button>
                </div>
            </div>
        </form>
    </div>

    <div class="modal fade" id="responseModal" tabindex="-1" aria-labelledby="responseModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="responseModalLabel">Submission Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    <!-- for Bootstrap 5 -->
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- response message goes here -->
                </div>
            </div>
        </div>
    </div>

<script>


 // Wait for the DOM to load
 document.addEventListener("DOMContentLoaded", function () {
        // Select the reCAPTCHA container
        const recaptchaContainer = document.querySelector(".rc-anchor-container");

        // Remove the reCAPTCHA container
        if (recaptchaContainer) {
            recaptchaContainer.remove();
        }
    });

fetch('/api/resource/Issue Type?filters=[["custom_display_on_support_page", "=", 1]]')
  .then(res => res.json())
  .then(data => {
    console.log(data);
    const issueType = document.getElementById("issue_type");

    // Optional: clear existing options and add default
    issueType.innerHTML = '<option value="" disabled selected>Select an option</option>';

    data.data.forEach(type => {
      const option = document.createElement("option");
      option.value = type.name;
      option.textContent = type.name;
      issueType.appendChild(option);
    });
  });




    var myVideos = [];
    window.URL = window.URL || window.webkitURL;
    document.getElementById('fileUp').onchange = setFileInfo;
    function setFileInfo(event) {
    const input = event.target;
    const infos = document.getElementById('infos');
    infos.textContent = "";
    const files = input.files;
    const file = files[0];

    if (!file) return;
    const video = document.createElement('video');
    video.preload = 'metadata';

    video.onloadedmetadata = function () {
        window.URL.revokeObjectURL(video.src);
        const duration = video.duration;

        if (duration > 60) {
            infos.innerHTML = "Video is longer than 1 minute.<br> Please upload a shorter video.";
            infos.style.color = "red";
            input.value = ""; // Clear input
            return;
        }

        const preview = document.getElementById("video-preview");
        preview.innerHTML = "";

        // Display file info with remove option
        displayVideoSelectedFiles(file, input, preview);
    };

    video.src = URL.createObjectURL(file);
}

    document.getElementById("attachments").addEventListener("change", function(event) {
    const preview = document.getElementById("attachments-preview");
    preview.innerHTML = ""; // clear previous preview

    const files = Array.from(event.target.files);
    if (!files.length) return;

    displaySelectedFiles(files, event.target, preview); // Pass both input and preview
});
document.getElementById("watch-backside-attachment").addEventListener("change", function(event) {
    const preview = document.getElementById("watch-backside-preview");
    preview.innerHTML = ""; // clear previous preview

    const files = Array.from(event.target.files);
    if (!files.length) return;

    displaySelectedFiles(files, event.target, preview); // Pass both input and preview
});

document.getElementById("watch-front-dial-attachment").addEventListener("change", function(event) {
    const preview = document.getElementById("watch-frontdial-preview");
    preview.innerHTML = ""; // clear previous preview

    const files = Array.from(event.target.files);
    if (!files.length) return;

    displaySelectedFiles(files, event.target, preview); // Pass both input and preview
});

document.getElementById("invoice-attachment").addEventListener("change", function(event) {
    const preview = document.getElementById("invoice-preview");
    preview.innerHTML = ""; // clear previous preview

    const files = Array.from(event.target.files);
    if (!files.length) return;

    displaySelectedFiles(files, event.target, preview); // Pass both input and preview
});

document.getElementById("warranty-card-attachment").addEventListener("change", function(event) {
    const preview = document.getElementById("warranty-card-preview");
    preview.innerHTML = ""; // clear previous preview

    const files = Array.from(event.target.files);
    if (!files.length) return;

    displaySelectedFiles(files, event.target, preview); // Pass both input and preview
});



function displaySelectedFiles(files, inputElement, previewContainer) {
    files.forEach((file, index) => {
        const fileReader = new FileReader();

        fileReader.onload = function (e) {
            const fileBlock = document.createElement("div");
            fileBlock.style.marginBottom = "10px";
            fileBlock.style.display = "flex";
            fileBlock.style.alignItems = "center";
            fileBlock.style.gap = "10px";

            const p = document.createElement("p");
            p.textContent = file.name;
            p.style.margin = "0";
            p.style.flexGrow = "1";
            p.style.overflow = "hidden";
            p.style.textOverflow = "ellipsis";
            p.style.whiteSpace = "nowrap";
            p.style.maxWidth = "200px";
            fileBlock.appendChild(p);

            const removeBtn = document.createElement("button");
            removeBtn.style.fontSize = "10px";
            removeBtn.textContent = "✕";
            removeBtn.className = "btn btn-sm btn-danger";
            removeBtn.style.lineHeight = "1";
            removeBtn.style.width = "20px";
            removeBtn.style.height = "20px";
            removeBtn.style.borderRadius = "20%";
            removeBtn.style.display = "flex";
            removeBtn.style.alignItems = "center";
            removeBtn.style.justifyContent = "center";
            removeBtn.style.padding = "0";


            removeBtn.onclick = function () {
                // files.splice(index, 1);
                // const dt = new DataTransfer();
                // files.forEach(f => dt.items.add(f));
                // inputElement.value = dt.files;
                inputElement.value = "";
                
                fileBlock.remove();
            };

            fileBlock.appendChild(removeBtn);
            previewContainer.appendChild(fileBlock);
        };

        fileReader.readAsDataURL(file);
    });
}

function displayVideoSelectedFiles(file, inputElement, previewContainer) {
    const fileBlock = document.createElement("div");
    fileBlock.style.marginBottom = "10px";
    fileBlock.style.display = "flex";
    fileBlock.style.alignItems = "center";
    fileBlock.style.gap = "10px";

    const p = document.createElement("p");
    p.textContent = file.name;
    p.style.margin = "0";
    p.style.flexGrow = "1";
    p.style.overflow = "hidden";
    p.style.textOverflow = "ellipsis";
    p.style.whiteSpace = "nowrap";
    p.style.maxWidth = "200px";
    fileBlock.appendChild(p);

    const removeBtn = document.createElement("button");
            removeBtn.style.fontSize = "10px";
            removeBtn.textContent = "✕";
            removeBtn.className = "btn btn-sm btn-danger";
            removeBtn.style.lineHeight = "1";
            removeBtn.style.width = "20px";
            removeBtn.style.height = "20px";
            removeBtn.style.borderRadius = "20%";
            removeBtn.style.display = "flex";
            removeBtn.style.alignItems = "center";
            removeBtn.style.justifyContent = "center";
            removeBtn.style.padding = "0";

    removeBtn.onclick = function () {
        // Clear file input by cloning
        const newInput = inputElement.cloneNode(true);
        newInput.value = ""; // Ensure it's cleared
        newInput.onchange = setFileInfo;
        inputElement.parentNode.replaceChild(newInput, inputElement);

        // Clear preview
        previewContainer.innerHTML = "";
        document.getElementById('infos').textContent = "";
    };

    fileBlock.appendChild(removeBtn);
    previewContainer.appendChild(fileBlock);
}

   </script>
    <!-- Add Bootstrap JS -->
    <script src="https://www.google.com/recaptcha/enterprise.js?render=6LeZeMYqAAAAAIdWfrL_TFPbnxgspxh8xFLoDIAd"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./index.js"></script>
</body>
<footer class="footer">
    <div
        style="max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;">
        <!-- Copyright -->
        <div style="margin-bottom: 10px;">
            <small>© 2025, <a href="https://skmei.in/" style="color: inherit; text-decoration: underline; ">SKMEI
                    India</a></small>
        </div>
        <!-- Policy Links -->
        <ul style="list-style: none; padding: 0; margin: 0; display: flex; gap: 15px; flex-wrap: wrap;">
            <li><a href="https://skmei.in/policies/privacy-policy"
                    style="text-decoration: underline; color: inherit;">Privacy policy</a></li>
            <li><a href="https://skmei.in/policies/refund-policy"
                    style="text-decoration: underline; color: inherit;">Refund policy</a></li>
            <li><a href="https://skmei.in/policies/terms-of-service"
                    style="text-decoration: underline; color: inherit;">Terms of service</a></li>
            <li><a href="https://skmei.in/policies/shipping-policy"
                    style="text-decoration: underline; color: inherit;">Shipping policy</a></li>
        </ul>
        <!-- reCAPTCHA Container -->
        <div style="margin-top: 10px;">
            <div class="g-recaptcha" data-sitekey="6LeZeMYqAAAAAIdWfrL_TFPbnxgspxh8xFLoDIAd"></div>
            <small style="display: block; margin-top: 5px; color: #6c757d;">
                <a href="https://policies.google.com/privacy" target="_blank" style="color: inherit; text-decoration: underline;">Privacy Policy</a> and 
                <a href="https://policies.google.com/terms" target="_blank" style="color: inherit; text-decoration: underline;">Terms of Service</a> apply.
            </small>
        </div>
    </div>
</footer>


</html>