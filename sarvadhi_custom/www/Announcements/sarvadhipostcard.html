<!DOCTYPE html>
<html>

<head>
    <title>Announcements</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }

        .container {
            width: 60%;
            margin: auto;
        }

        .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: left;
        }

        .emoji {
            font-size: 24px;
            cursor: pointer;
            margin: 5px;
            display: inline-block;
            padding: 5px;
        }

        .selected {
            border: 2px solid rgb(153, 0, 255);
            border-radius: 50%;
        }
    </style>
</head>

<body>
    <h1>Announcements</h1>
    <div class="container">
        {% for post in postcards %}
        <div class="card" data-post-id="{{ post.name }}">
            <h3>{{ post.created_by }}</h3>
            <h3>{{ post.subject }}</h3>
            <p>{{ post.description }}</p>
            <div class="emoji-container">
                <span class="emoji" data-emoji="üëç">üëç</span>
                <span class="emoji" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</span>
                <span class="emoji" data-emoji="üòÇ">üòÇ</span>
                <span class="emoji" data-emoji="üòÆ">üòÆ</span>
                <span class="emoji" data-emoji="üò¢">üò¢</span>
            </div>
        </div>
        {% endfor %}
    </div>
   
    <script>
        $(document).ready(function () {
            // Load previous reactions when page loads
            $(".card").each(function () {
                var postId = $(this).data("post-id");
                fetchUserReaction(postId, $(this));
            });

            $(".emoji").click(function () {
                var emoji = $(this).data("emoji");
                var postId = $(this).closest(".card").data("post-id");
                var selected = $(this).hasClass("selected");

                $(this).siblings().removeClass("selected");
                if (selected) {
                    $(this).removeClass("selected");
                    updateReaction(postId, ""); // Remove reaction
                } else {
                    $(this).addClass("selected");
                    updateReaction(postId, emoji);
                }
            });

            function updateReaction(postId, emoji) {
                $.post("/api/method/sarvadhi_custom.api.reactions.update_reaction", {
                    post_id: postId,
                    emoji: emoji
                }, function (response) {
                    console.log("Reaction updated", response);
                });
            }

            function fetchUserReaction(postId, cardElement) {
                $.get("/api/method/sarvadhi_custom.api.reactions.get_user_reaction", {
                    post_id: postId
                }, function (response) {
                    if (response.message && response.message.reaction) {
                        var emoji = response.message.reaction;
                        cardElement.find(`.emoji[data-emoji="${emoji}"]`).addClass("selected");
                    }
                });
            }
        });
    </script>

</body>

</html>